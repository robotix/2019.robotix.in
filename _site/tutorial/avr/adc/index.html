<!DOCTYPE html> <html lang="en"> <head> <meta charset="utf-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no"> <meta name="description" content="Technology Robotix Society is an official society under the Technology Students' Gymkhana IIT Kharagpur."> <meta name="keywords" content="robotix, robotics, iit, kgp, team, events, society, technology, tutorial"> <meta name="google-site-verification" content="ZR618hQWwV_OwtWa033492kzvBaQYxBc1ZauYc5oO5A" /> <!-- Social: Twitter --> <meta name="twitter:card" content="summary"> <meta name="twitter:site" content="@robotixiitkgp"> <meta name="twitter:title" content="Analog to Digital Converter"> <meta name="twitter:description" content="Technology Robotix Society is an official society under the Technology Students' Gymkhana IIT Kharagpur."> <meta name="twitter:image:src" content="/img/favicons/favicon-196x196.png"> <!-- Social: Facebook / Open Graph --> <meta property="og:title" content="Analog to Digital Converter" /> <meta property="og:site_name" content="Technology Robotix Society, IIT Kharagpur" /> <meta property="og:type" content="website" /> <meta property="og:image" content="/img/favicons/favicon-196x196.png" /> <meta property="og:description" content="Technology Robotix Society is an official society under the Technology Students' Gymkhana IIT Kharagpur." /> <!-- Social: Google+ --> <link href="https://plus.google.com/102868621563384739622" rel="publisher"> <title>Analog to Digital Converter &bull; Technology Robotix Society, IIT Kharagpur</title> <link rel="shortcut icon" href="/img/favicons/favicon.ico"> <link rel="apple-touch-icon" sizes="152x152" href="/img/favicons/apple-touch-icon-152x152.png"> <link rel="apple-touch-icon" sizes="144x144" href="/img/favicons/apple-touch-icon-144x144.png"> <link rel="apple-touch-icon" sizes="120x120" href="/img/favicons/apple-touch-icon-120x120.png"> <link rel="apple-touch-icon" sizes="114x114" href="/img/favicons/apple-touch-icon-114x114.png"> <link rel="apple-touch-icon" sizes="76x76" href="/img/favicons/apple-touch-icon-76x76.png"> <link rel="apple-touch-icon" sizes="72x72" href="/img/favicons/apple-touch-icon-72x72.png"> <link rel="apple-touch-icon" sizes="60x60" href="/img/favicons/apple-touch-icon-60x60.png"> <link rel="apple-touch-icon" sizes="57x57" href="/img/favicons/apple-touch-icon-57x57.png"> <link rel="icon" type="image/png" href="/img/favicons/favicon-196x196.png"> <link rel="icon" type="image/png" href="/img/favicons/favicon-160x160.png"> <link rel="icon" type="image/png" href="/img/favicons/favicon-96x96.png"> <link rel="icon" type="image/png" href="/img/favicons/favicon-32x32.png"> <link rel="icon" type="image/png" href="/img/favicons/favicon-16x16.png"> <meta name="msapplication-TileColor" content="#2b5797"> <meta name="msapplication-TileImage" content="/img/favicons/mstile-144x144.png"> <meta name="msapplication-config" content="/img/favicons/browserconfig.xml"> <meta name="theme-color" content="#2b5797"> <link href="/css/main.css" rel="stylesheet"> <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries --> <!-- WARNING: Respond.js doesn't work if you view the page via file:// --> <!--[if lt IE 9]> <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script> <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script> <![endif]--> </head> <body> <div id="st-container" class="st-container"> <div class="st-pusher"> <div class="st-content"> <!-- Begin Top Section --> <section id="top-section" class="top-section image-section " style=""> <div class="overlay gradient-overlay"></div> <header id="top-header" class="top-header"> <div class="overlay white-solid"></div> <svg id="menu-trigger" class="menu-trigger icn icon-menu visible-xs" viewBox="0 0 32 32"> <use xlink:href="/img/sprites/sprites.min.svg#icon-menu"></use> </svg> <a href="/" id="logo-header" class="logo-header"> <div class="logo"></div> </a> <nav class="st-menu st-effect" id="menu"> <div class="logo-navbar logo visible-xs"></div> <ul> <li> <a class="" href=" https://makerspace.robotix.in/" target="_blank">Makerspace</a> </li> <li> <a class="" href="/FAQs/" >FAQs</a> </li> <li> <a class="" href="/workshops/" >Workshops</a> </li> <li> <a class="" href="/event/" >Events</a> </li> <li> <a class="" href="/blog/" >Blog</a> </li> <li> <a class="" href="/tutorial" >Tutorials</a> </li> <li> <a class="" href="/team/" >Team</a> </li> <li> <a class="" href="/about-us/" >About Us</a> </li> </ul> <ul id="bottom-navlinks" class="bottom-navlinks visible-xs"> <li> <a href="https://contact.robotix.in" target="_blank">Contact Us</a> </li> </ul> </nav> </header> <div class="content-wrapper"> <div class="jumbotron text-left"> <div class="animated hiding" data-animation="fadeInLeft" data-delay="500"> <h1>Analog to Digital Converter</h1> </div> </div> </div> </section> <!-- End Top Section --> <!-- Begin Post--> <section id="post-section" class="post-section"> <div class="content-wrapper text-left"> <div class="col-md-10 col-sm-10 col-lg-offset-2 col-md-offset-2 col-sm-offset-1"> <div class="col-lg-8 col-md-10 col-xs-12"> <article class="row post"> <div class="post-body"><h4 id="introduction">Introduction</h4> <p>A lot of times when you deal with robotics, working only with <em>+Vcc</em> (Logic 1) and <em>Ground</em> (Logic 0) might not be enough. What if we have an analog input, i.e., value varies over a range, say <em>0V</em> to <em>+5V</em>?<br /> Then we require a tool that converts this analog voltage to discrete values. <strong>Analog to Digital Converter</strong> (ADC) is such a tool. In this tutorial, we shall learn the basic implementation of ADC in Atmel megaAVR devices in Single ended mode with code examples on ATmega16 to get started.</p> <p>The ATmega16 ADC has 10-bit resolution. This means that an analog voltage between <em>0V</em> and <em>5V</em> will be encoded into one of 1024 binary representations via 8 channels that are port A pins from A0 to A7.</p> <p><img src="/img/tutorial/avr/adc/adc.png" alt="ATmega16 Pin Layout" class="img-responsive" /></p> <p>The reference voltage as shown in figure can be either less or equal to the supply voltage of the microcontroller.<br /> This means that if you are using a 10 bit precision and <em>5V</em> is the <em>Vref</em>, then, 0 corresponds to <em>0V</em>, 1023 <code class="highlighter-rouge">(2^10 - 1)</code> corresponds to <em>5V</em>. Similarly, the intermediate voltages correspond to their corresponding ADC value. So, what exactly is the output that we get from ADC?</p> <p>ADC value is nothing but, the corresponding digital value given by:</p> <figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="no">ADC</span> <span class="o">=</span> <span class="no">Vin</span> <span class="n">x</span> <span class="mi">255</span> <span class="o">/</span> <span class="no">Vref</span>           <span class="c1">#(8 bit)</span>
<span class="no">ADC</span> <span class="o">=</span> <span class="no">Vin</span> <span class="n">x</span> <span class="mi">1023</span> <span class="o">/</span> <span class="no">Vref</span>          <span class="c1">#(10 bit)</span></code></pre></figure> <h4 id="registers">Registers</h4> <p>You need to declare certain registers before you initiate ADC specifying the conditions it needs to follow.</p> <h5 id="adcsra">ADCSRA</h5> <p><img src="/img/tutorial/avr/adc/adcsra.png" alt="ADCSRA" class="img-responsive" /></p> <p><strong>ADEN</strong>: ADC Enable bit, this bit must be set to 1 for turning ADC on.<br /> <strong>ADSC</strong>: ADC Start Conversion bit, this bit is set to 1 to start ADC conversion, as soon as conversion is completed this bit is set back to 0 by the hardware.<br /> <strong>ADATE</strong>: ADC Auto Trigger Enable, this bit is set to 1 to enable auto triggering of ADC conversion.<br /> <strong>ADIF</strong>: ADC Interrupt Flag, this bit is set to 1 when ADC conversion gets complete.<br /> <strong>ADIE</strong>: ADC Interrupt Enable, this bit is set to 1 if we want to activate the ADC conversion complete interrupt.<br /> <strong>ADPS</strong>: ADC Prescaler bits, these bits are used to set the ADC clock frequency.</p> <p><code class="highlighter-rouge">ADC clock frequency = XTAL frequency / Prescaler</code><br /> The ADC clock frequency must lie somewhere between <em>50 kHz</em> to <em>200 kHz</em> to get maximum resolution. If ADC resolution of less than 10 bits required, then the ADC clock frequency can be higher than <em>200 kHz</em>. At <em>1 MHz</em> it is possible to achieve eight bits of maximum resolution.</p> <p>In the microcontroller we’re discussing, prescaler values of 2, 4, 8, 16, 32, 64 &amp; 128 are provided. A typical core clock speed is <em>16 MHz</em>. So if you are running your AVR board at <em>16 Mhz</em>, you can set the ADC clock to one of the following values:</p> <figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="mi">16</span> <span class="n">MHz</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">=</span> <span class="mi">8</span> <span class="n">MHz</span>  
<span class="mi">16</span> <span class="n">MHz</span> <span class="o">/</span> <span class="mi">4</span> <span class="o">=</span> <span class="mi">4</span> <span class="n">MHz</span>  
<span class="mi">16</span> <span class="n">MHz</span> <span class="o">/</span> <span class="mi">8</span> <span class="o">=</span> <span class="mi">2</span> <span class="n">MHz</span>  
<span class="mi">16</span> <span class="n">MHz</span> <span class="o">/</span> <span class="mi">16</span> <span class="o">=</span> <span class="mi">1</span> <span class="n">MHz</span>  
<span class="mi">16</span> <span class="n">MHz</span> <span class="o">/</span> <span class="mi">32</span> <span class="o">=</span> <span class="mi">500</span> <span class="n">kHz</span>  
<span class="mi">16</span> <span class="n">MHz</span> <span class="o">/</span> <span class="mi">64</span> <span class="o">=</span> <span class="mi">250</span> <span class="n">kHz</span>  
<span class="mi">16</span> <span class="n">MHz</span> <span class="o">/</span> <span class="mi">128</span> <span class="o">=</span> <span class="mi">125</span> <span class="n">kHz</span>  </code></pre></figure> <p>Since the ADC clock needs to be between <em>50 kHz</em> &amp; <em>200 kHz</em> for 10 bit accuracy, we can only use the 128 prescaler and achieve a <em>125 kHz</em> ADC clock.</p> <h5 id="admux">ADMUX</h5> <p><img src="/img/tutorial/avr/adc/admux.png" alt="ADMUX" class="img-responsive" /></p> <p><strong>REFS</strong>: REFS1 and REFS0 bits determine the source of reference voltage whether it is internal or the external voltage source connected to AREF pin.<br /> <strong>MUX</strong>: MUX bits are used to select between the channels which will provide data to ADC for conversion.<br /> <strong>ADLAR</strong>: ADLAR bit when set to 1 gives the left adjusted result in data registers ADCH and ADCL. These help to get the required precision in the output.</p> <p><img src="/img/tutorial/avr/adc/adlar.png" alt="ADLAR" class="img-responsive" /></p> <p>When ADCL is read, the ADC Data Register is not updated until ADCH is read. Consequently, if the result is left adjusted and no more than 8-bit precision is required, it is sufficient to read ADCH. Otherwise, ADCL must be read first, then ADCH.</p> <h4 id="code">Code</h4> <p>The following code has used an 8-bit precision. Where, the input is constantly at Pin A0. The 8 bit output is stored in PORT B.</p> <figure class="highlight"><pre><code class="language-c" data-lang="c"><span class="cp">#define F_CPU 16000000UL
</span>
<span class="cp">#include &lt;util/delay.h&gt;
#include &lt;avr/io.h&gt;
</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">//Declaring Port A as input
</span>    <span class="n">DDRA</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>

    <span class="c1">//Declaring port B as output
</span>    <span class="n">DDRB</span><span class="o">=</span><span class="mi">255</span><span class="p">;</span>

    <span class="c1">// Enabled ADC and set prescaler division factor as 128
</span>    <span class="n">ADCSRA</span><span class="o">|=</span><span class="p">(</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="n">ADEN</span><span class="p">)</span><span class="o">|</span><span class="p">(</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="n">ADPS2</span><span class="p">)</span> <span class="o">|</span><span class="p">(</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="n">ADPS1</span><span class="p">)</span> <span class="o">|</span><span class="p">(</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="n">ADPS0</span><span class="p">);</span>

    <span class="c1">//Vref is same as Vcc, Input constantly at Pin 0 of port A and Setting ADLAR to 1 left shifts the bits for an 8-bit precision
</span>    <span class="n">ADMUX</span><span class="o">|=</span><span class="p">(</span><span class="mi">0</span><span class="o">&lt;&lt;</span><span class="n">REFS1</span><span class="p">)</span><span class="o">|</span><span class="p">(</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="n">REFS0</span><span class="p">)</span><span class="o">|</span><span class="p">(</span><span class="mi">0</span><span class="o">&lt;&lt;</span><span class="n">MUX4</span><span class="p">)</span><span class="o">|</span><span class="p">(</span><span class="mi">0</span><span class="o">&lt;&lt;</span><span class="n">MUX3</span><span class="p">)</span><span class="o">|</span><span class="p">(</span><span class="mi">0</span><span class="o">&lt;&lt;</span><span class="n">MUX2</span><span class="p">)</span><span class="o">|</span><span class="p">(</span><span class="mi">0</span><span class="o">&lt;&lt;</span><span class="n">MUX1</span><span class="p">)</span><span class="o">|</span><span class="p">(</span><span class="mi">0</span><span class="o">&lt;&lt;</span><span class="n">MUX0</span><span class="p">)</span><span class="o">|</span><span class="p">(</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="n">ADLAR</span><span class="p">);</span>

    <span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">//Start ADC
</span>        <span class="n">ADCSRA</span><span class="o">|=</span><span class="p">(</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="n">ADSC</span><span class="p">);</span>

        <span class="c1">//Do nothing till the conversion is over. Here, the condition that ADSC is cleared after conversion has been used. You can also use ADIF
</span>        <span class="k">while</span><span class="p">((</span><span class="n">ADCSRA</span><span class="o">&amp;</span> <span class="p">(</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="mi">6</span><span class="p">))</span><span class="o">!=</span><span class="mi">0</span><span class="p">);</span>

        <span class="c1">//The ADC value stored in ADCH has been sent to PORT B as output.
</span>        <span class="n">PORTB</span> <span class="o">=</span> <span class="n">ADCH</span><span class="p">;</span>

        <span class="n">_delay_ms</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>
    <span class="p">};</span>
<span class="p">}</span></code></pre></figure> <p>For a small demonstration, you can connect pin A0 to a powered potentiometer and vary its resistance to get ADC values of intermediate voltages. You can display this output on LCD display or you can even display it’s binary output on LEDs.</p> </div> </article> </div> </div> </div> </section> <!-- End Post --> <!-- Begin Footer --> <footer id="footer" class="footer"> <div class="row"> <div class="logo logo-footer pull-right"></div> </div> <div class="row"> <div class="col-md-4 col-xs-6"> <h5>Links</h5> <ul> <li><a href="https://drive.google.com/open?id=1jNJHFE1QjGOHFwhhzn6e774odGv-6eFQ" target="_blank">Robotix App</a></li> <li><a href="https://robotix.in/event/" target="_blank">Events</a></li> <li><a href="https://robotix.in/tutorial/" target="_blank">Tutorials</a></li> </ul> </div> <div class="col-md-4 col-xs-6"> <h5>Contacts</h5> <ul> <li><a href="https://contact.robotix.in" target="_blank">Contact Us</a></li> </ul> </div> <div class="col-md-4 col-xs-6"> <h5>Archives</h5> <ul> <li><a href="https://2018.robotix.in/" target="_blank">Robotix 2018</a></li> <li><a href="https://2017.robotix.in/" target="_blank">Robotix 2017</a></li> <li><a href="https://2016.robotix.in/" target="_blank">Robotix 2016</a></li> </ul> </div> </div> <div class="row"> <div class="col-md-6 col-xs-12"> <ul class="social-links"> <li> <a href="https://plus.google.com/102868621563384739622/" target="_blank"> <svg class="icn icon-google-plus" viewBox="0 0 30 32"> <use xlink:href="/img/sprites/sprites.min.svg#icon-google-plus"></use> </svg> </a> </li> <li> <a href="https://twitter.com/RobotixIITKgp" target="_blank"> <svg class="icn icon-twitter" viewBox="0 0 30 32"> <use xlink:href="/img/sprites/sprites.min.svg#icon-twitter"></use> </svg> </a> </li> <li> <a href="https://facebook.com/robotixiitkgp" target="_blank"> <svg class="icn icon-facebook" viewBox="0 0 30 32"> <use xlink:href="/img/sprites/sprites.min.svg#icon-facebook"></use> </svg> </a> </li> <li> <a href="https://www.youtube.com/robotixiitkgp" target="_blank"> <svg class="icn icon-youtube" viewBox="0 0 30 32"> <use xlink:href="/img/sprites/sprites.min.svg#icon-youtube"></use> </svg> </a> </li> <li> <a href="/feed.xml" target="_blank"> <svg class="icn icon-rss" viewBox="0 0 30 32"> <use xlink:href="/img/sprites/sprites.min.svg#icon-rss"></use> </svg> </a> </li> </ul> </div> </div> <div class="row"> <!-- Please don't delete this line--> <div class="col-md-6"> <p class="copyright"> &copy; 2018 Technology Robotix Society, IIT Kharagpur </p> </div> </div> </footer> <!-- End Footer --> </div> </div> </div> <!-- Begin Floating Action button--> <ul class="fab"> <li> <input type="text" class="search input-sm form-control" placeholder="Search the site..."> <button class="btn btn-danger waves-circle waves-effect waves-light waves-float rotate"> <h4 class="fab-text media-middle"><b>+</b></h4> </button> </li> </ul> <script> window.jQuery || document.write('<script src="/js/jquery-2.1.1.min.js"><\/script>') </script> <script> document.write('<script src="/js/bootstrap.min.js"><\/script>') </script> <script src="/js/default.min.js"></script> <script>Waves.displayEffect();</script> <script src="/js/scripts.min.js"></script> <script> (function(){ var handle = '@robotixiitkgp'; var a = document.createElement('script'); var m = document.getElementsByTagName('script')[0]; a.async = 1; a.src = 'https://nectar.ninja/api/v1/' + handle.slice(1); m.parentNode.insertBefore(a, m); })(); </script> <script> (function(w,d,t,u,n,s,e){w['SwiftypeObject']=n;w[n]=w[n]||function(){ (w[n].q=w[n].q||[]).push(arguments);};s=d.createElement(t); e=d.getElementsByTagName(t)[0];s.async=1;s.src=u;e.parentNode.insertBefore(s,e); })(window,document,'script','//s.swiftypecdn.com/install/v2/st.js','_st'); _st('install','a_iioDrTs6zXmqH8x5Yr','2.0.0'); </script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','https://www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-83617238-1', 'auto'); ga('send', 'pageview'); </script> </body> </html>

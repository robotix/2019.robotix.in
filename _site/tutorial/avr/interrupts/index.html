<!DOCTYPE html> <html lang="en"> <head> <meta charset="utf-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no"> <meta name="description" content="Technology Robotix Society is an official society under the Technology Students' Gymkhana IIT Kharagpur."> <meta name="keywords" content="robotix, robotics, iit, kgp, team, events, society, technology, tutorial"> <meta name="google-site-verification" content="ZR618hQWwV_OwtWa033492kzvBaQYxBc1ZauYc5oO5A" /> <!-- Social: Twitter --> <meta name="twitter:card" content="summary"> <meta name="twitter:site" content="@robotixiitkgp"> <meta name="twitter:title" content="Interrupts in AVR"> <meta name="twitter:description" content="Technology Robotix Society is an official society under the Technology Students' Gymkhana IIT Kharagpur."> <meta name="twitter:image:src" content="/img/favicons/favicon-196x196.png"> <!-- Social: Facebook / Open Graph --> <meta property="og:title" content="Interrupts in AVR" /> <meta property="og:site_name" content="Technology Robotix Society, IIT Kharagpur" /> <meta property="og:type" content="website" /> <meta property="og:image" content="/img/favicons/favicon-196x196.png" /> <meta property="og:description" content="Technology Robotix Society is an official society under the Technology Students' Gymkhana IIT Kharagpur." /> <!-- Social: Google+ --> <link href="https://plus.google.com/102868621563384739622" rel="publisher"> <title>Interrupts in AVR &bull; Technology Robotix Society, IIT Kharagpur</title> <link rel="shortcut icon" href="/img/favicons/favicon.ico"> <link rel="apple-touch-icon" sizes="152x152" href="/img/favicons/apple-touch-icon-152x152.png"> <link rel="apple-touch-icon" sizes="144x144" href="/img/favicons/apple-touch-icon-144x144.png"> <link rel="apple-touch-icon" sizes="120x120" href="/img/favicons/apple-touch-icon-120x120.png"> <link rel="apple-touch-icon" sizes="114x114" href="/img/favicons/apple-touch-icon-114x114.png"> <link rel="apple-touch-icon" sizes="76x76" href="/img/favicons/apple-touch-icon-76x76.png"> <link rel="apple-touch-icon" sizes="72x72" href="/img/favicons/apple-touch-icon-72x72.png"> <link rel="apple-touch-icon" sizes="60x60" href="/img/favicons/apple-touch-icon-60x60.png"> <link rel="apple-touch-icon" sizes="57x57" href="/img/favicons/apple-touch-icon-57x57.png"> <link rel="icon" type="image/png" href="/img/favicons/favicon-196x196.png"> <link rel="icon" type="image/png" href="/img/favicons/favicon-160x160.png"> <link rel="icon" type="image/png" href="/img/favicons/favicon-96x96.png"> <link rel="icon" type="image/png" href="/img/favicons/favicon-32x32.png"> <link rel="icon" type="image/png" href="/img/favicons/favicon-16x16.png"> <meta name="msapplication-TileColor" content="#2b5797"> <meta name="msapplication-TileImage" content="/img/favicons/mstile-144x144.png"> <meta name="msapplication-config" content="/img/favicons/browserconfig.xml"> <meta name="theme-color" content="#2b5797"> <link href="/css/main.css" rel="stylesheet"> <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries --> <!-- WARNING: Respond.js doesn't work if you view the page via file:// --> <!--[if lt IE 9]> <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script> <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script> <![endif]--> </head> <body> <div id="st-container" class="st-container"> <div class="st-pusher"> <div class="st-content"> <!-- Begin Top Section --> <section id="top-section" class="top-section image-section " style=""> <div class="overlay gradient-overlay"></div> <header id="top-header" class="top-header"> <div class="overlay white-solid"></div> <svg id="menu-trigger" class="menu-trigger icn icon-menu visible-xs" viewBox="0 0 32 32"> <use xlink:href="/img/sprites/sprites.min.svg#icon-menu"></use> </svg> <a href="/" id="logo-header" class="logo-header"> <div class="logo"></div> </a> <nav class="st-menu st-effect" id="menu"> <div class="logo-navbar logo visible-xs"></div> <ul> <li> <a class="" href=" https://makerspace.robotix.in/" target="_blank">Makerspace</a> </li> <li> <a class="" href="/FAQs/" >FAQs</a> </li> <li> <a class="" href="/workshops/" >Workshops</a> </li> <li> <a class="" href="/event/" >Events</a> </li> <li> <a class="" href="/blog/" >Blog</a> </li> <li> <a class="" href="/tutorial" >Tutorials</a> </li> <li> <a class="" href="/team/" >Team</a> </li> <li> <a class="" href="/about-us/" >About Us</a> </li> </ul> <ul id="bottom-navlinks" class="bottom-navlinks visible-xs"> <li> <a href="https://contact.robotix.in" target="_blank">Contact Us</a> </li> </ul> </nav> </header> <div class="content-wrapper"> <div class="jumbotron text-left"> <div class="animated hiding" data-animation="fadeInLeft" data-delay="500"> <h1>Interrupts in AVR</h1> </div> </div> </div> </section> <!-- End Top Section --> <!-- Begin Post--> <section id="post-section" class="post-section"> <div class="content-wrapper text-left"> <div class="col-md-10 col-sm-10 col-lg-offset-2 col-md-offset-2 col-sm-offset-1"> <div class="col-lg-8 col-md-10 col-xs-12"> <article class="row post"> <div class="post-body"><h4 id="what-are-interrupts">What are Interrupts?</h4> <p>One of the most fundamental and useful principles of modern embedded processors are <em>interrupts</em>. An interrupt is a way for an external (or, sometimes, internal) event to pause the current processor’s activity, so that it can complete a brief task before resuming execution where it left off.</p> <p>Example:<br /> <em>Let’s say we are at home, writing an excellent tutorial on how a principle of modern embedded processors works. We are very interested in this topic, so we are devoting all our concentration to our keyboard. However, half way though, the phone rings. Despite not being by the phone waiting for a call, we are able to stop what we are doing, take the call, and go back where we left off once we have hung up.</em></p> <p><em>Consider you’re at home watching an excellent movie(HD print). You are very much interested in watching the end of the movie and suddenly the doorbell rings. Now you have to pause your movie, get up from your chair, open the door and then resume the movie form where you left it.</em></p> <p>This is how a microprocessor’s interrupt works. We can tell the processor to look for some specific specific external event (like data reception complete or pin changing its state like going from high to low) to become true. While processor checks for these events we can parallely do some other job. When these events occur, we stop the current task, handle the interrupt, and resume back where we left off. This gives us a great deal of flexibility. Rather that constantly checking the FLAG bit via code we can trust interrupts to do the job of checking.</p> <p>What we are doing is called <em>asynchronous</em> processing - that is, we are processing the interrupt events outside the regular “execution thread” of the main program. The point to be noted here is that we aren’t doing parallel programing (- running two or more codes simultaneously) but we are just pausing the current program and resuming to it after handing the interrupt.</p> <p>We can link a specific interrupt source to a specific handler routine, called an <strong><em>Interrupt Service Routine</em></strong>, or <strong><em>ISR</em></strong> for short.</p> <h4 id="interrupts-available-in-avr">Interrupts available in AVR</h4> <p><strong>There are two main sources of interrupts:</strong></p> <ul> <li>Hardware Interrupts : which occur in response to a changing external event such as a pin going low, or a timer reaching a preset value</li> <li>Software Interrupts : which occur in response to a command issued in software</li> </ul> <p>In 8-bit AVRs the software interrupts are not available, which are basically used for generating user defined Exceptions and handling them as and when they occur.<br /> Each microcontroller has a set of interrupt sources available.<br /> Some of the interrupts available in ATmega16 are as follows:</p> <ul> <li>External Interrupt</li> <li>Timer Interrupt</li> <li>USART Receive and Transmit Interrupt</li> <li>EEPROM Ready Interrupt</li> <li>ADC conversion complete</li> </ul> <h4 id="how-do-we-handle-interrupts">How do we handle Interrupts?</h4> <p>The method of handling interrupts differs in different languages.</p> <p>For an Interrupt to fire ISR three things must be true</p> <ol> <li>The AVR’s global Interrupts Enable bit must be set to one in the microcontroller control register SREG. This allows the AVR’s core to process interrupts via ISRs when set, and prevents them from running when set to zero. It is like a global ON/OFF switch for the interrupts. By default this bit is zero.</li> <li>The individual interrupt source’s enable bit must be set. Each interrupt source has a separate interrupt enable bit in the related peripherals control registers, which turns on the ISR for that interrupt. This must also be set, so that when the interrupt event occurs the processor runs the associated ISR.</li> <li>The condition of the interrupt must be me - for example when the adc conversion is complete then only it will fire ADC conversion interrupt.</li> </ol> <p>When all three conditions are met, the AVR will fire our ISR each time the interrupt event occurs.</p> <p>The C code for writing the ISR is as follows<br /> <strong>pseudo C code:</strong></p> <p>#include &lt;avr/interrupt.h&gt;</p> <p>ISR({Vector Source}_vect)<br /> {<br />    // ISR code to execute here<br /> }</p> <h4 id="how-do-we-enable-an-interrupt">How do we enable an interrupt?</h4> <p>If you simply add an ISR to your existing program, you will find that it appears to do nothing when you try to fire it. This is because while we have defined an ISR, we haven’t enabled the interrupt source.</p> <p>Firstly, we need to set the I bit in the SREG register. This is the Global Interrupt Enable bit, without which the AVR will simply ignore any and all interrupts.<br /> In C, we can use predefined library functions. In the case of AVR-GCC we just use the sei() and cli() macro equivalents defined in &lt;avr/interrupt.h&gt;:</p> <p>pseudo C code:</p> <p>sei(); // Enable Global Interrupts<br /> cli(); // Disable Global Interrupts</p> <p>Now, we need to enable a specific interrupt source, to satisfy the second condition for firing an ISR. The way to do this varies greatly between interrupt sources, but always involves setting a specific flag in one of the peripheral registers. Let’s set an interrupt on the <em>USART Receive Complete (USART RX) interrupt</em>. According to the datasheet, we want to set the RXCIE bit in the UCSRB register:</p> <p>pseudo C code:</p> <table> <tbody> <tr> <td>UCSRB</td> <td>= (1 « RXCIE);</td> </tr> </tbody> </table> <p>After sei(); and setting RXCIE the ISR will code will run when the data receive is complete.</p> <h4 id="some-important-points">Some Important Points</h4> <p>There are a few things to keep in mind when using interrupts in your program:</p> <p>Now we have learnt what are interrupts in general. In the next tutorial we will see how to implement specific interrupts like ADC Conversion Complete Interrupt, External Interrupts, Timer Interrupts etc.</p> </div> </article> </div> </div> </div> </section> <!-- End Post --> <!-- Begin Footer --> <footer id="footer" class="footer"> <div class="row"> <div class="logo logo-footer pull-right"></div> </div> <div class="row"> <div class="col-md-4 col-xs-6"> <h5>Links</h5> <ul> <li><a href="https://drive.google.com/open?id=1jNJHFE1QjGOHFwhhzn6e774odGv-6eFQ" target="_blank">Robotix App</a></li> <li><a href="https://robotix.in/event/" target="_blank">Events</a></li> <li><a href="https://robotix.in/tutorial/" target="_blank">Tutorials</a></li> </ul> </div> <div class="col-md-4 col-xs-6"> <h5>Contacts</h5> <ul> <li><a href="https://contact.robotix.in" target="_blank">Contact Us</a></li> </ul> </div> <div class="col-md-4 col-xs-6"> <h5>Archives</h5> <ul> <li><a href="https://2018.robotix.in/" target="_blank">Robotix 2018</a></li> <li><a href="https://2017.robotix.in/" target="_blank">Robotix 2017</a></li> <li><a href="https://2016.robotix.in/" target="_blank">Robotix 2016</a></li> </ul> </div> </div> <div class="row"> <div class="col-md-6 col-xs-12"> <ul class="social-links"> <li> <a href="https://plus.google.com/102868621563384739622/" target="_blank"> <svg class="icn icon-google-plus" viewBox="0 0 30 32"> <use xlink:href="/img/sprites/sprites.min.svg#icon-google-plus"></use> </svg> </a> </li> <li> <a href="https://twitter.com/RobotixIITKgp" target="_blank"> <svg class="icn icon-twitter" viewBox="0 0 30 32"> <use xlink:href="/img/sprites/sprites.min.svg#icon-twitter"></use> </svg> </a> </li> <li> <a href="https://facebook.com/robotixiitkgp" target="_blank"> <svg class="icn icon-facebook" viewBox="0 0 30 32"> <use xlink:href="/img/sprites/sprites.min.svg#icon-facebook"></use> </svg> </a> </li> <li> <a href="https://www.youtube.com/robotixiitkgp" target="_blank"> <svg class="icn icon-youtube" viewBox="0 0 30 32"> <use xlink:href="/img/sprites/sprites.min.svg#icon-youtube"></use> </svg> </a> </li> <li> <a href="/feed.xml" target="_blank"> <svg class="icn icon-rss" viewBox="0 0 30 32"> <use xlink:href="/img/sprites/sprites.min.svg#icon-rss"></use> </svg> </a> </li> </ul> </div> </div> <div class="row"> <!-- Please don't delete this line--> <div class="col-md-6"> <p class="copyright"> &copy; 2018 Technology Robotix Society, IIT Kharagpur </p> </div> </div> </footer> <!-- End Footer --> </div> </div> </div> <!-- Begin Floating Action button--> <ul class="fab"> <li> <input type="text" class="search input-sm form-control" placeholder="Search the site..."> <button class="btn btn-danger waves-circle waves-effect waves-light waves-float rotate"> <h4 class="fab-text media-middle"><b>+</b></h4> </button> </li> </ul> <script> window.jQuery || document.write('<script src="/js/jquery-2.1.1.min.js"><\/script>') </script> <script> document.write('<script src="/js/bootstrap.min.js"><\/script>') </script> <script src="/js/default.min.js"></script> <script>Waves.displayEffect();</script> <script src="/js/scripts.min.js"></script> <script> (function(){ var handle = '@robotixiitkgp'; var a = document.createElement('script'); var m = document.getElementsByTagName('script')[0]; a.async = 1; a.src = 'https://nectar.ninja/api/v1/' + handle.slice(1); m.parentNode.insertBefore(a, m); })(); </script> <script> (function(w,d,t,u,n,s,e){w['SwiftypeObject']=n;w[n]=w[n]||function(){ (w[n].q=w[n].q||[]).push(arguments);};s=d.createElement(t); e=d.getElementsByTagName(t)[0];s.async=1;s.src=u;e.parentNode.insertBefore(s,e); })(window,document,'script','//s.swiftypecdn.com/install/v2/st.js','_st'); _st('install','a_iioDrTs6zXmqH8x5Yr','2.0.0'); </script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','https://www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-83617238-1', 'auto'); ga('send', 'pageview'); </script> </body> </html>
